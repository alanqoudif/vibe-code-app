# دليل الإشعارات المحلية - learnz

## نظرة عامة

تم تطوير نظام إشعارات محلية متقدم للتطبيق يعمل مع Expo Notifications. النظام يدعم:

- إشعارات تذكير الحصص
- إشعارات المهام
- إشعارات فورية
- إشعارات مخصصة
- دعم متعدد اللغات (العربية والإنجليزية)

## الميزات الرئيسية

### 1. إشعارات تذكير الحصص
- تذكير قبل 5، 10، 15، 30 دقيقة من بداية الحصة
- إشعارات متعددة لنفس الحصة
- دعم الحصص المتكررة (أسبوعياً)
- معلومات مفصلة (اسم الحصة، الوقت، المكان)

### 2. إشعارات المهام
- تذكير قبل موعد انتهاء المهمة
- إشعارات مخصصة للمهام المهمة

### 3. إشعارات فورية
- إشعارات للاختبار
- تنبيهات عاجلة
- رسائل ترحيبية

## كيفية الاستخدام

### 1. طلب إذن الإشعارات

```typescript
import { NotificationService } from '../services/NotificationService';

// طلب إذن الإشعارات
const hasPermission = await NotificationService.requestPermissions();
if (hasPermission) {
  console.log('تم تفعيل الإشعارات');
} else {
  console.log('تم رفض الإذن');
}
```

### 2. جدولة تذكير حصة

```typescript
const classData = {
  id: '1',
  name: 'الرياضيات',
  time: '09:00 AM',
  days: ['Monday', 'Wednesday'],
  location: 'القاعة 101',
  reminders: ['15 دقيقة']
};

// جدولة تذكير واحد
const notificationId = await NotificationService.scheduleClassReminder(classData);

// جدولة تذكيرات متعددة
const notificationIds = await NotificationService.scheduleMultipleClassReminders(
  classData, 
  [5, 15, 30] // 5، 15، 30 دقيقة قبل الحصة
);
```

### 3. إرسال إشعار فوري

```typescript
// إشعار فوري
const notificationId = await NotificationService.sendImmediateNotification(
  'عنوان الإشعار',
  'محتوى الإشعار',
  { type: 'urgent' } // بيانات إضافية
);
```

### 4. جدولة جميع إشعارات الحصص

```typescript
// الحصول على جميع الحصص
const classes = await DatabaseService.getEvents(userId);

// جدولة إشعارات لجميع الحصص
await NotificationService.scheduleAllClassReminders(classes);
```

### 5. إدارة الإشعارات

```typescript
// إلغاء إشعار محدد
await NotificationService.cancelNotification(notificationId);

// إلغاء جميع الإشعارات
await NotificationService.cancelAllNotifications();

// الحصول على الإشعارات المجدولة
const scheduledNotifications = await NotificationService.getScheduledNotifications();
```

## اختبار الإشعارات

### 1. شاشة اختبار الإشعارات

تم إنشاء شاشة خاصة لاختبار الإشعارات يمكن الوصول إليها من:
- الإعدادات > أدوات المطور > اختبار الإشعارات

### 2. اختبارات متاحة

- **طلب إذن الإشعارات**: اختبار طلب إذن الإشعارات
- **إشعار اختبار (5 ثوانٍ)**: إشعار مؤجل للاختبار
- **إشعار فوري**: إشعار يظهر فوراً
- **جدولة إشعارات جميع الحصص**: جدولة إشعارات لجميع الحصص المحفوظة
- **إلغاء جميع الإشعارات**: إلغاء جميع الإشعارات المجدولة

### 3. مراقبة الإشعارات

الشاشة تعرض:
- حالة الإشعارات (مفعلة/معطلة)
- قائمة بالإشعارات المجدولة
- تفاصيل كل إشعار (العنوان، المحتوى، الوقت)

## إعدادات التطبيق

### 1. app.json

```json
{
  "expo": {
    "plugins": [
      [
        "expo-notifications",
        {
          "icon": "./assets/icon.png",
          "color": "#512DA8",
          "mode": "production",
          "sounds": ["./assets/notification.wav"],
          "defaultChannel": "default"
        }
      ]
    ],
    "android": {
      "permissions": [
        "POST_NOTIFICATIONS"
      ]
    }
  }
}
```

### 2. إعدادات Android

```json
{
  "android": {
    "permissions": [
      "POST_NOTIFICATIONS"
    ]
  }
}
```

## أنواع الإشعارات المدعومة

### 1. إشعارات الحصص (class_reminder)
```typescript
{
  type: 'class_reminder',
  classId: '123',
  className: 'الرياضيات',
  classTime: '09:00 AM',
  classLocation: 'القاعة 101',
  reminderMinutes: 15
}
```

### 2. إشعارات المهام (task_deadline)
```typescript
{
  type: 'task_deadline',
  taskId: '456'
}
```

### 3. نصائح الدراسة (study_tip)
```typescript
{
  type: 'study_tip'
}
```

### 4. إجراءات سريعة (quick_action)
```typescript
{
  type: 'quick_action'
}
```

### 5. إشعارات الاختبار (test_notification)
```typescript
{
  type: 'test_notification'
}
```

### 6. إشعارات فورية (immediate)
```typescript
{
  type: 'immediate'
}
```

## معالجة النقر على الإشعارات

عند النقر على إشعار، يتم استدعاء `handleNotificationResponse` التي تعرض:

- تفاصيل الحصة للمواعيد
- معلومات المهمة للمهام
- نصائح الدراسة
- رسائل تأكيد للاختبارات

## أفضل الممارسات

### 1. طلب الأذونات
- اطلب إذن الإشعارات عند أول استخدام للتطبيق
- اشرح للمستخدم فائدة الإشعارات
- قدم خيارات لتخصيص الإشعارات

### 2. جدولة الإشعارات
- استخدم أوقات تذكير منطقية (5، 15، 30 دقيقة)
- تجنب جدولة إشعارات كثيرة جداً
- ألغِ الإشعارات القديمة قبل جدولة جديدة

### 3. محتوى الإشعارات
- استخدم عناوين واضحة ومختصرة
- اكتب محتوى مفيد ومفهوم
- استخدم رموز تعبيرية مناسبة

### 4. اختبار الإشعارات
- اختبر الإشعارات على أجهزة مختلفة
- تأكد من عمل الإشعارات في الخلفية
- اختبر إلغاء الإشعارات

## استكشاف الأخطاء

### 1. الإشعارات لا تظهر
- تحقق من إذن الإشعارات
- تأكد من إعدادات الجهاز
- اختبر على جهاز حقيقي (ليس محاكي)

### 2. الإشعارات لا تعمل في الخلفية
- تحقق من إعدادات البطارية
- تأكد من عدم إغلاق التطبيق من الخلفية
- اختبر على أجهزة مختلفة

### 3. مشاكل في التوقيت
- تحقق من منطق حساب الوقت
- تأكد من صحة تنسيق الوقت
- اختبر مع مناطق زمنية مختلفة

## التطوير المستقبلي

### 1. ميزات مخططة
- إشعارات push من الخادم
- تخصيص أصوات الإشعارات
- إشعارات تفاعلية
- دعم الإشعارات المجدولة المتقدمة

### 2. تحسينات مقترحة
- إشعارات ذكية بناءً على سلوك المستخدم
- دمج مع تقويم الجهاز
- إشعارات للمواعيد المهمة
- نظام تفضيلات متقدم

## الدعم والمساعدة

إذا واجهت أي مشاكل مع الإشعارات:

1. تحقق من شاشة اختبار الإشعارات
2. راجع سجلات التطبيق
3. اختبر على جهاز حقيقي
4. تأكد من إعدادات الجهاز

---

**ملاحظة**: هذا النظام يعمل مع الإشعارات المحلية فقط. للإشعارات من الخادم، نحتاج إلى إعداد Expo Push Notifications أو خدمة إشعارات خارجية.
